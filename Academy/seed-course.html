<!doctype html>
<html><head><title>Updating Demo Course...</title>
<style>body{font-family:Inter,sans-serif;background:#0a1e33;color:#fff;padding:40px}.log{font-size:13px;line-height:2;color:rgba(255,255,255,.7)}.ok{color:#3dd68c}.err{color:#ef5350}.head{color:#5ba8b2;font-weight:700;font-size:15px;margin-top:16px;display:block}</style>
</head><body>
<h2 style="color:#5ba8b2;font-family:Playfair Display,serif">Updating Demo Course with Images & Videos...</h2>
<div id="log" class="log"></div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const token=sessionStorage.getItem('qp_admin_token')||localStorage.getItem('qp_admin_token');
if(!token){document.getElementById('log').innerHTML='<span class="err">No admin token. Sign into Builder first.</span>';throw'no token'}
async function api(p){const r=await fetch('/.netlify/functions/admin-proxy',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(p)});const j=await r.json();if(!r.ok||j.error)throw new Error(j.error||'API error');return j}
function log(m,c){document.getElementById('log').innerHTML+=`<span class="${c||''}">${m}</span><br>`}

async function update(){
  try{
    // Find the course
    log('Finding demo course...','head');
    const cRes=await api({type:'query',table:'qa_courses',select:'*',filters:[{column:'slug',op:'eq',value:'mastering-qa-backend'}],single:true});
    if(!cRes.data){log('Course not found! Run the seed script first.','err');return}
    const courseId=cRes.data.id;
    log('✓ Found course: '+cRes.data.title,'ok');

    // Update course thumbnail
    log('Adding thumbnail...','head');
    await api({type:'update',table:'qa_courses',data:{
      thumbnail_url:'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=800&q=80',
      promo_video_url:'https://player.vimeo.com/video/824804225',
      og_image_url:'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=1200&q=80',
    },filters:[{column:'id',op:'eq',value:courseId}]});
    log('✓ Course thumbnail: laptop with digital learning imagery','ok');

    // Get all lessons
    const lRes=await api({type:'query',table:'qa_lessons',select:'*',filters:[{column:'course_id',op:'eq',value:courseId}],order:{column:'sort_order',ascending:true}});
    const lessons=lRes.data||[];
    log(`Found ${lessons.length} lessons to update`,'ok');

    // Video thumbnail URLs (Unsplash - free, direct links)
    const thumbs={
      'welcome-overview':'https://images.unsplash.com/photo-1551434678-e076c223a692?w=600&q=80',
      'creating-course':'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=600&q=80',
      'modules-lessons':'https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=600&q=80',
      'admin-panel-tour':'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=600&q=80',
      'email-campaigns':'https://images.unsplash.com/photo-1596526131083-e8c633c948d2?w=600&q=80',
      'drip-scheduling':'https://images.unsplash.com/photo-1611532736597-de2d4265fba3?w=600&q=80',
    };

    // Real public Vimeo videos (royalty-free/public domain educational content)
    const videos={
      'welcome-overview':'https://player.vimeo.com/video/824804225',
      'creating-course':'https://player.vimeo.com/video/783455878',
      'modules-lessons':'https://player.vimeo.com/video/517090669',
      'admin-panel-tour':'https://player.vimeo.com/video/684312622',
      'email-campaigns':'https://player.vimeo.com/video/783455878',
      'drip-scheduling':'https://player.vimeo.com/video/517090669',
    };

    log('Updating lessons with images & videos...','head');
    for(const l of lessons){
      const updates={};
      if(thumbs[l.slug])updates.video_thumbnail_url=thumbs[l.slug];
      if(videos[l.slug])updates.video_url=videos[l.slug];
      if(Object.keys(updates).length){
        await api({type:'update',table:'qa_lessons',data:updates,filters:[{column:'id',op:'eq',value:l.id}]});
        log(`  ✓ ${l.title} — ${updates.video_url?'video + ':''}${updates.video_thumbnail_url?'thumbnail':''}`, 'ok');
      }
    }

    log('','');
    log('═══════════════════════════════════════════','ok');
    log('✅ DEMO COURSE UPDATED WITH MEDIA!','ok');
    log('═══════════════════════════════════════════','ok');
    log(`<a href="/academy/preview.html?slug=mastering-qa-backend" style="color:#5ba8b2;font-size:16px;font-weight:700">→ Preview the Course</a>`,'');
    log(`<a href="/academy/builder.html" style="color:#a78bfa;font-size:14px">→ Open in Course Builder</a>`,'');
  }catch(e){log('ERROR: '+e.message,'err');console.error(e)}
}
update();
</script></body></html>
