<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reset Password — Quantum Academy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/shared.css">
  <link rel="stylesheet" href="/academy/css/academy.css">
</head>
<body class="qa-page">
  <div id="shared-header"></div>

  <main>
    <div class="qa-auth-card">
      <h2>Set New Password</h2>
      <p class="subtitle">Enter your new password below.</p>

      <div class="qa-error" id="error"></div>
      <div class="qa-success" id="success"></div>

      <div id="formWrap">
        <div class="qa-input-group">
          <label for="password">New Password</label>
          <input type="password" id="password" class="qa-input" placeholder="Enter new password (min 8 characters)" minlength="8" required>
        </div>
        <div class="qa-input-group">
          <label for="confirmPassword">Confirm Password</label>
          <input type="password" id="confirmPassword" class="qa-input" placeholder="Confirm new password" minlength="8" required>
        </div>
        <button class="qa-btn qa-btn-primary" id="submitBtn" onclick="handleReset()">Update Password</button>
      </div>

      <div id="successWrap" style="display:none;text-align:center;padding:20px 0">
        <div style="font-size:48px;margin-bottom:16px">✅</div>
        <h3 style="font-family:'Playfair Display',serif;margin-bottom:8px">Password Updated!</h3>
        <p style="color:var(--qa-text-muted);margin-bottom:24px">Your password has been successfully changed.</p>
        <a href="/academy/" class="qa-btn qa-btn-primary" style="justify-content:center">Go to Academy →</a>
      </div>
    </div>
  </main>

  <div id="shared-footer"></div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/shared.js"></script>
  <script src="/academy/js/academy.js"></script>
  <script>
    async function handleReset() {
      const password = document.getElementById('password').value;
      const confirm = document.getElementById('confirmPassword').value;
      const errorEl = document.getElementById('error');
      const successEl = document.getElementById('success');
      const btn = document.getElementById('submitBtn');

      errorEl.style.display = 'none';
      successEl.style.display = 'none';

      if (!password || password.length < 8) {
        errorEl.textContent = 'Password must be at least 8 characters.';
        errorEl.style.display = 'block';
        return;
      }

      if (password !== confirm) {
        errorEl.textContent = 'Passwords do not match.';
        errorEl.style.display = 'block';
        return;
      }

      btn.disabled = true;
      btn.textContent = 'Updating...';

      try {
        const { error } = await sb.auth.updateUser({ password });
        if (error) throw error;

        document.getElementById('formWrap').style.display = 'none';
        document.getElementById('successWrap').style.display = 'block';
      } catch (err) {
        errorEl.textContent = err.message || 'Failed to update password. The reset link may have expired.';
        errorEl.style.display = 'block';
        btn.disabled = false;
        btn.textContent = 'Update Password';
      }
    }
  </script>
</body>
</html>
