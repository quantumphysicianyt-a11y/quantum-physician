<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Dashboard — Quantum Academy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/academy/css/academy.css">
  <style>
    /* ============================================
       DASHBOARD V4 — STANDALONE APP LAYOUT
       Brand: navy #0a1e33, teal #5ba8b2, taupe #ad9b84, cyan #4acfd9
       ============================================ */

    :root {
      --d-sidebar-w: 260px;
      --d-teal: #5ba8b2;
      --d-teal-light: #4acfd9;
      --d-taupe: #ad9b84;
      --d-navy: #0a1e33;
      --d-navy-deep: #071825;
      --d-navy-mid: #0f2942;
      --d-navy-card: #112a42;
      --d-navy-hover: #153450;
      --d-border: rgba(91,168,178,.15);
      --d-border-hover: rgba(91,168,178,.35);
      --d-text: rgba(255,255,255,.88);
      --d-text-muted: rgba(255,255,255,.5);
      --d-radius: 12px;
      --d-ease: .3s cubic-bezier(.22,1,.36,1);
    }

    /* Light theme overrides */
    [data-theme="light"] {
      --d-navy: #f5f3ef;
      --d-navy-deep: #ebe8e2;
      --d-navy-mid: #ffffff;
      --d-navy-card: #ffffff;
      --d-navy-hover: #f0ede8;
      --d-border: rgba(173,155,132,.2);
      --d-border-hover: rgba(173,155,132,.4);
      --d-text: #1a1a2e;
      --d-text-muted: rgba(26,26,46,.5);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--d-navy);
      color: var(--d-text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* === LAYOUT === */
    .d-layout {
      min-height: 100vh;
    }

    /* === SIDEBAR === */
    .d-sidebar {
      background: var(--d-navy-deep);
      border-right: 1px solid var(--d-border);
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0; left: 0; bottom: 0;
      width: var(--d-sidebar-w);
      z-index: 50;
      overflow-y: auto;
    }

    /* Logo */
    .d-sidebar .logo {
      padding: 24px 20px 16px;
      border-bottom: 1px solid var(--d-border);
    }
    .d-sidebar .logo img {
      max-width: 150px;
      height: auto;
      display: block;
      margin: 0 auto;
      transition: opacity .2s;
    }
    .d-sidebar .logo img:hover { opacity: .8; }

    /* Profile + referral */
    .d-profile {
      padding: 20px 18px;
      border-bottom: 1px solid var(--d-border);
      text-align: center;
    }
    .d-avatar {
      width: 60px; height: 60px; border-radius: 50%;
      background: linear-gradient(135deg, var(--d-teal), var(--d-teal-light));
      display: flex; align-items: center; justify-content: center;
      font-size: 24px; font-weight: 700; color: #fff;
      font-family: "Playfair Display", serif;
      margin: 0 auto 10px;
      position: relative;
      animation: avatarPulse 3s ease-in-out infinite;
    }
    @keyframes avatarPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(91,168,178,.3); }
      50% { box-shadow: 0 0 0 8px rgba(91,168,178,0); }
    }
    .d-profile .name {
      font-size: 15px; font-weight: 600; margin-bottom: 2px;
    }
    .d-profile .email {
      font-size: 11px; color: var(--d-text-muted); word-break: break-all;
    }

    /* Referral mini — under profile */
    .d-ref-mini {
      margin-top: 14px;
      background: rgba(91,168,178,.04);
      border: 1px solid var(--d-border-hover);
      border-radius: 10px;
      padding: 14px 16px;
      animation: fadeIn .6s ease .3s both;
    }
    .d-ref-mini .ref-label {
      font-size: 10px; text-transform: uppercase; letter-spacing: .1em;
      color: var(--d-taupe); margin-bottom: 10px;
      display: flex; align-items: center; gap: 5px;
      justify-content: center;
    }
    .d-ref-mini .ref-label svg { width: 12px; height: 12px; stroke: var(--d-taupe); }
    .d-ref-mini .ref-code-row {
      display: flex; align-items: center; gap: 8px;
      background: rgba(0,0,0,.15);
      border-radius: 6px;
      padding: 8px 10px;
    }
    .d-ref-mini .ref-code {
      font-family: monospace; font-size: 15px; font-weight: 700;
      letter-spacing: .12em; color: var(--d-teal); flex: 1;
      text-align: center;
    }
    .d-ref-mini .ref-copy {
      background: var(--d-teal); color: #fff; border: none;
      padding: 6px 12px; border-radius: 5px;
      font-size: 10px; font-weight: 600; cursor: pointer;
      text-transform: uppercase; letter-spacing: .04em;
      transition: all .15s; flex-shrink: 0;
    }
    .d-ref-mini .ref-copy:hover { opacity: .8; }
    .d-ref-mini .ref-stats {
      display: flex; gap: 0; margin-top: 10px;
      font-size: 10px; color: var(--d-text-muted);
      justify-content: center;
    }
    .d-ref-mini .ref-stats span {
      flex: 1; text-align: center;
      padding: 6px 0;
    }
    .d-ref-mini .ref-stats span + span {
      border-left: 1px solid var(--d-border);
    }
    .d-ref-mini .ref-stats strong { color: var(--d-teal); display: block; font-size: 13px; margin-bottom: 1px; }

    /* QR Code */
    .d-ref-mini .qr-toggle {
      display: block; width: 100%; margin-top: 8px;
      background: none; border: none;
      font-size: 10px; color: var(--d-teal);
      cursor: pointer; text-align: center;
      text-transform: uppercase; letter-spacing: .05em;
    }
    .d-ref-mini .qr-toggle:hover { text-decoration: underline; }
    .d-ref-mini .qr-wrap {
      display: none; margin-top: 10px; text-align: center;
    }
    .d-ref-mini .qr-wrap.open { display: block; }
    .d-ref-mini .qr-wrap canvas {
      border-radius: 8px;
      background: #fff;
      padding: 8px;
    }

    /* Nav */
    .d-nav { padding: 12px 0; flex: 1; }
    .d-nav a {
      display: flex; align-items: center; gap: 10px;
      padding: 11px 20px;
      font-size: 13px; color: var(--d-text-muted);
      text-decoration: none; transition: all .15s;
      border-left: 3px solid transparent;
      position: relative;
    }
    .d-nav a:hover { color: var(--d-text); background: rgba(255,255,255,.02); }
    .d-nav a.active {
      color: var(--d-teal); background: rgba(91,168,178,.06);
      border-left-color: var(--d-teal);
    }
    .d-nav a svg { width: 17px; height: 17px; stroke: currentColor; opacity: .7; }
    .d-nav a.active svg { opacity: 1; }
    .d-nav .divider { height: 1px; background: var(--d-border); margin: 8px 20px; }

    /* Theme toggle */
    .d-theme-toggle {
      display: flex; align-items: center; gap: 10px;
      padding: 11px 20px;
      font-size: 13px; color: var(--d-text-muted);
      cursor: pointer; border: none; background: none;
      width: 100%; text-align: left;
      transition: all .15s;
    }
    .d-theme-toggle:hover { color: var(--d-text); background: rgba(255,255,255,.02); }
    .d-theme-toggle svg { width: 17px; height: 17px; stroke: currentColor; opacity: .7; }
    .d-theme-switch {
      margin-left: auto;
      width: 36px; height: 20px;
      background: var(--d-border);
      border-radius: 10px;
      position: relative;
      transition: background .3s;
    }
    .d-theme-switch::after {
      content: '';
      position: absolute;
      top: 2px; left: 2px;
      width: 16px; height: 16px;
      border-radius: 50%;
      background: var(--d-teal);
      transition: transform .3s;
    }
    [data-theme="light"] .d-theme-switch { background: var(--d-taupe); }
    [data-theme="light"] .d-theme-switch::after { transform: translateX(16px); background: #fff; }

    /* Sidebar footer */
    .d-sidebar-footer {
      padding: 12px 20px;
      border-top: 1px solid var(--d-border);
    }
    .d-sidebar-footer a {
      display: flex; align-items: center; gap: 8px;
      font-size: 12px; color: var(--d-text-muted);
      text-decoration: none; padding: 6px 0;
      transition: color .15s;
    }
    .d-sidebar-footer a:hover { color: var(--d-text); }
    .d-sidebar-footer a svg { width: 15px; height: 15px; stroke: currentColor; }

    /* === MAIN CONTENT === */
    .d-main {
      margin-left: var(--d-sidebar-w);
      padding: 32px 36px 80px;
      min-height: 100vh;
    }

    /* Success banner */
    .d-success {
      background: linear-gradient(135deg, rgba(91,168,178,.1), rgba(74,207,217,.05));
      border: 1px solid rgba(91,168,178,.3);
      border-radius: 10px;
      padding: 16px 20px;
      margin-bottom: 24px;
      display: flex; align-items: center; gap: 12px;
      animation: slideDown .5s ease;
    }
    @keyframes slideDown { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }
    .d-success .s-dot {
      width: 32px; height: 32px; border-radius: 50%;
      background: rgba(91,168,178,.15);
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .d-success .s-dot svg { width: 16px; height: 16px; stroke: var(--d-teal); }
    .d-success h4 { font-size: 14px; color: var(--d-teal); margin-bottom: 1px; }
    .d-success p { font-size: 12px; color: var(--d-text-muted); }
    .d-success .dismiss { margin-left:auto; background:none; border:none; color:var(--d-text-muted); cursor:pointer; font-size:16px; }

    /* Page header */
    .d-header { margin-bottom: 24px; }
    .d-header h1 {
      font-family: "Playfair Display", serif;
      font-size: 28px; font-weight: 600;
      background: linear-gradient(135deg, var(--d-text), var(--d-teal));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: fadeIn .6s ease;
    }
    .d-header p { font-size: 13px; color: var(--d-text-muted); margin-top: 4px; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* Stats */
    .d-stats {
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 12px; margin-bottom: 28px;
    }
    .d-stat {
      background: var(--d-navy-card);
      border: 1px solid var(--d-border);
      border-radius: 10px;
      padding: 16px 18px;
      display: flex; align-items: center; gap: 12px;
      transition: all .25s;
      animation: fadeUp .5s ease both;
    }
    .d-stat:nth-child(1) { animation-delay: .05s; }
    .d-stat:nth-child(2) { animation-delay: .1s; }
    .d-stat:nth-child(3) { animation-delay: .15s; }
    .d-stat:nth-child(4) { animation-delay: .2s; }
    @keyframes fadeUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
    .d-stat:hover { border-color: var(--d-border-hover); transform: translateY(-2px); }
    .d-stat .ico {
      width: 38px; height: 38px; border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .d-stat .ico svg { width: 18px; height: 18px; }
    .d-stat .ico.c1 { background: rgba(91,168,178,.1); }
    .d-stat .ico.c1 svg { stroke: var(--d-teal); }
    .d-stat .ico.c2 { background: rgba(74,207,217,.1); }
    .d-stat .ico.c2 svg { stroke: var(--d-teal-light); }
    .d-stat .ico.c3 { background: rgba(173,155,132,.1); }
    .d-stat .ico.c3 svg { stroke: var(--d-taupe); }
    .d-stat .ico.c4 { background: rgba(91,168,178,.08); }
    .d-stat .ico.c4 svg { stroke: var(--d-teal); }
    .d-stat .val {
      font-family: "Playfair Display", serif;
      font-size: 22px; font-weight: 700; line-height: 1;
    }
    .d-stat .lbl { font-size: 10px; color: var(--d-text-muted); text-transform: uppercase; letter-spacing: .06em; margin-top: 2px; }

    /* Section */
    .d-section { margin-bottom: 28px; }
    .d-section-head {
      font-size: 12px; font-weight: 600; text-transform: uppercase;
      letter-spacing: .08em; color: var(--d-text-muted); margin-bottom: 14px;
      padding-bottom: 8px; border-bottom: 1px solid var(--d-border);
      display: flex; align-items: center; gap: 6px;
    }
    .d-section-head svg { width: 14px; height: 14px; stroke: var(--d-taupe); }

    /* Continue card */
    .d-continue {
      background: var(--d-navy-card);
      border: 1px solid var(--d-border);
      border-radius: var(--d-radius);
      display: flex; overflow: hidden;
      text-decoration: none; color: inherit;
      transition: all .3s;
      animation: fadeUp .5s ease .25s both;
      position: relative;
    }
    .d-continue::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--d-teal), var(--d-teal-light), var(--d-taupe));
      opacity: 0;
      transition: opacity .3s;
    }
    .d-continue:hover::before { opacity: 1; }
    .d-continue:hover {
      border-color: var(--d-border-hover);
      box-shadow: 0 8px 40px rgba(0,0,0,.15);
      transform: translateY(-2px);
    }
    .d-continue .ct {
      width: 300px; flex-shrink: 0; overflow: hidden;
      position: relative; background: var(--d-navy-mid);
    }
    .d-continue .ct img { width:100%; height:100%; object-fit:cover; object-position:center; transition:transform .6s; }
    .d-continue:hover .ct img { transform: scale(1.04); }
    .d-continue .ct .play-o {
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.2); opacity:0; transition:opacity .3s;
    }
    .d-continue:hover .ct .play-o { opacity:1; }
    .d-continue .ct .play-o span {
      width:48px; height:48px; border-radius:50%;
      background: linear-gradient(135deg, var(--d-teal), var(--d-teal-light));
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 4px 20px rgba(91,168,178,.4);
    }
    .d-continue .ct .play-o span svg { width:20px; height:20px; stroke:#fff; margin-left:2px; }
    .d-continue .cb {
      padding: 24px 28px; flex:1;
      display:flex; flex-direction:column; justify-content:center;
    }
    .d-continue .cb .tag {
      font-size:10px; letter-spacing:.12em; text-transform:uppercase;
      color: var(--d-taupe); font-weight:600; margin-bottom:8px;
      display:flex; align-items:center; gap:5px;
    }
    .d-continue .cb .tag svg { width:12px; height:12px; stroke:var(--d-taupe); }
    .d-continue .cb h3 {
      font-family:"Playfair Display",serif; font-size:20px;
      font-weight:600; margin-bottom:6px; line-height:1.3;
    }
    .d-continue .cb .meta { font-size:12px; color:var(--d-text-muted); margin-bottom:14px; }
    .d-continue .cb .prog { display:flex; align-items:center; gap:10px; margin-bottom:16px; }
    .d-continue .cb .prog .bar { flex:1; height:5px; background:rgba(255,255,255,.08); border-radius:3px; overflow:hidden; }
    .d-continue .cb .prog .bar .fill {
      height:100%; border-radius:3px;
      background: linear-gradient(90deg, var(--d-teal), var(--d-teal-light));
      transition: width .6s ease;
    }
    .d-continue .cb .prog .pct { font-size:11px; font-weight:600; color:var(--d-teal); }
    .d-continue .cb .go {
      display:inline-flex; align-items:center; gap:6px;
      padding:10px 22px;
      background: linear-gradient(135deg, var(--d-teal), var(--d-teal-light));
      color:#fff; border-radius:999px;
      font-size:11px; font-weight:600; letter-spacing:.04em;
      text-transform:uppercase; width:fit-content;
      box-shadow: 0 4px 16px rgba(91,168,178,.3);
      transition: all .2s;
    }
    .d-continue .cb .go:hover { box-shadow: 0 6px 24px rgba(91,168,178,.5); transform:translateY(-1px); }
    .d-continue .cb .go svg { width:13px; height:13px; stroke:#fff; }

    /* Course grid */
    .d-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
    .d-card {
      background: var(--d-navy-card);
      border: 1px solid var(--d-border);
      border-radius: var(--d-radius);
      overflow: hidden;
      text-decoration: none; color: inherit;
      transition: all .3s;
      display: flex; flex-direction: column;
      animation: fadeUp .5s ease both;
      position: relative;
    }
    .d-card:nth-child(1) { animation-delay: .1s; }
    .d-card:nth-child(2) { animation-delay: .15s; }
    .d-card:nth-child(3) { animation-delay: .2s; }
    .d-card:nth-child(4) { animation-delay: .25s; }
    .d-card:nth-child(5) { animation-delay: .3s; }
    .d-card:hover {
      border-color: var(--d-border-hover);
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0,0,0,.2);
    }
    .d-card .img {
      aspect-ratio: 16/9; overflow: hidden; position: relative;
      background: var(--d-navy-mid);
    }
    .d-card .img img { width:100%; height:100%; object-fit:cover; transition:transform .6s; }
    .d-card:hover .img img { transform: scale(1.05); }
    .d-card .img .badge {
      position:absolute; top:8px; right:8px;
      padding:4px 10px; border-radius:999px;
      font-size:10px; font-weight:600;
      display:flex; align-items:center; gap:3px;
      backdrop-filter: blur(8px);
    }
    .d-card .img .badge svg { width:11px; height:11px; stroke:currentColor; }
    .d-card .img .badge.done { background:rgba(91,168,178,.85); color:#fff; }
    .d-card .img .badge.new { background:rgba(173,155,132,.85); color:#fff; }
    /* Gradient overlay bottom of thumbnail */
    .d-card .img::after {
      content:''; position:absolute; bottom:0; left:0; right:0; height:40px;
      background: linear-gradient(transparent, rgba(10,30,51,.6));
      pointer-events: none;
    }
    .d-card .bd {
      padding: 16px 18px 18px; flex:1;
      display:flex; flex-direction:column;
    }
    .d-card .bd h4 {
      font-family:"Playfair Display",serif;
      font-size:15px; font-weight:600; margin-bottom:6px; line-height:1.3;
    }
    .d-card .bd .mt {
      font-size:11px; color:var(--d-text-muted); margin-bottom:10px;
      display:flex; align-items:center; gap:8px;
    }
    .d-card .bd .mt span { display:flex; align-items:center; gap:3px; }
    .d-card .bd .mt svg { width:12px; height:12px; stroke:currentColor; }
    .d-card .bd .bar-wrap { margin-bottom:4px; }
    .d-card .bd .bar-wrap .bar { height:4px; background:rgba(255,255,255,.06); border-radius:2px; overflow:hidden; }
    .d-card .bd .bar-wrap .bar .fill {
      height:100%; border-radius:2px;
      background: linear-gradient(90deg, var(--d-teal), var(--d-teal-light));
      transition: width .6s ease;
    }
    .d-card .bd .bar-label {
      font-size:10px; color:var(--d-text-muted);
      display:flex; justify-content:space-between;
    }
    .d-card .bd .done-text { font-size:11px; color:var(--d-teal); margin:6px 0; }
    .d-card .bd .act {
      margin-top:auto; padding-top:12px;
      border-top:1px solid var(--d-border);
      font-size:11px; font-weight:600; color:var(--d-teal);
      text-transform:uppercase; letter-spacing:.04em;
      display:flex; align-items:center; gap:4px;
      transition: gap .2s;
    }
    .d-card:hover .bd .act { gap: 8px; }
    .d-card .bd .act svg { width:13px; height:13px; stroke:var(--d-teal); }

    /* Empty */
    .d-empty {
      text-align:center; padding:60px 20px;
      animation: fadeIn .6s ease;
    }
    .d-empty .icon {
      width:72px; height:72px; border-radius:50%;
      background:rgba(91,168,178,.06);
      display:flex; align-items:center; justify-content:center;
      margin:0 auto 20px;
    }
    .d-empty .icon svg { width:30px; height:30px; stroke:var(--d-teal); opacity:.4; }
    .d-empty h3 { font-family:"Playfair Display",serif; font-size:22px; margin-bottom:8px; }
    .d-empty p { font-size:13px; color:var(--d-text-muted); margin-bottom:24px; }

    /* Mobile */
    .d-mob-btn {
      display:none; position:fixed; bottom:20px; right:20px; z-index:200;
      width:48px; height:48px; border-radius:50%;
      background: linear-gradient(135deg, var(--d-teal), var(--d-teal-light));
      color:#fff; border:none; cursor:pointer;
      box-shadow: 0 4px 20px rgba(91,168,178,.4);
      align-items:center; justify-content:center;
    }
    .d-mob-btn svg { width:20px; height:20px; stroke:#fff; }
    .d-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); z-index:49; }
    .d-overlay.open { display:block; }

    @media (max-width:960px) {
      .d-sidebar { display:none; width:270px; }
      .d-sidebar.open { display:flex; z-index:300; }
      .d-mob-btn { display:flex; }
      .d-main { margin-left:0; padding:20px 18px 100px; }
      .d-stats { grid-template-columns:repeat(2,1fr); }
      .d-continue { flex-direction:column; }
      .d-continue .ct { width:100%; height:180px; }
      .d-continue .cb { padding:20px; }
      .d-grid { grid-template-columns:repeat(2,1fr); }
    }
    @media (max-width:480px) {
      .d-stats { grid-template-columns:1fr; }
      .d-grid { grid-template-columns:1fr; }
    }

    /* QA button override for dark/light */
    .d-main .qa-btn-primary {
      background: linear-gradient(135deg, var(--d-teal), var(--d-teal-light));
      color: #fff;
    }
  </style>
</head>
<body>
  <!-- SVG Icons -->
  <svg style="display:none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <symbol id="i-layout" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></symbol>
      <symbol id="i-book" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></symbol>
      <symbol id="i-gift" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></symbol>
      <symbol id="i-logout" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></symbol>
      <symbol id="i-check" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></symbol>
      <symbol id="i-play" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></symbol>
      <symbol id="i-arrow" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></symbol>
      <symbol id="i-grad" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></symbol>
      <symbol id="i-layers" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></symbol>
      <symbol id="i-clock" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></symbol>
      <symbol id="i-trophy" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></symbol>
      <symbol id="i-menu" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="18" x2="20" y2="18"/></symbol>
      <symbol id="i-star" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></symbol>
      <symbol id="i-video" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></symbol>
      <symbol id="i-sun" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></symbol>
      <symbol id="i-settings" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></symbol>
      <symbol id="i-home" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></symbol>
      <symbol id="i-cal" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></symbol>
    </defs>
  </svg>

  <div class="d-layout">
    <!-- SIDEBAR -->
    <aside class="d-sidebar" id="sidebar">
      <div class="logo">
        <a href="/academy/"><img src="/assets/images/QuantumPhysAcad_STACKED-RGB.png" alt="Quantum Academy"></a>
      </div>

      <div class="d-profile">
        <div class="d-avatar" id="avatar">?</div>
        <div class="name" id="profileName">—</div>
        <div class="email" id="profileEmail">—</div>

        <!-- Referral mini card -->
        <div class="d-ref-mini" id="refSection" style="display:none">
          <div class="ref-label"><svg><use href="#i-gift"/></svg> Your Referral Code</div>
          <div class="ref-code-row">
            <span class="ref-code" id="refCode">—</span>
            <button class="ref-copy" onclick="copyRef()">Copy</button>
          </div>
          <div class="ref-stats">
            <span><strong id="refBal">$0</strong>Credit</span>
            <span><strong id="refEarn">$0</strong>Earned</span>
          </div>
          <button class="qr-toggle" onclick="toggleQR()">Show QR Code</button>
          <div class="qr-wrap" id="qrWrap">
            <canvas id="qrCanvas" width="120" height="120"></canvas>
          </div>
        </div>
      </div>

      <nav class="d-nav">
        <a href="/academy/dashboard.html" class="active"><svg><use href="#i-layout"/></svg> Dashboard</a>
        <a href="/academy/"><svg><use href="#i-book"/></svg> Browse Courses</a>
        <a href="javascript:void(0)" onclick="openEventsPanel()"><svg><use href="#i-cal"/></svg> Schedule</a>
        <a href="/"><svg><use href="#i-home"/></svg> Main Site</a>
        <div class="divider"></div>
        <button class="d-theme-toggle" onclick="toggleTheme()">
          <svg><use href="#i-sun"/></svg> Appearance
          <div class="d-theme-switch"></div>
        </button>
      </nav>

      <div class="d-sidebar-footer">
        <a href="#" onclick="handleSignOut(); return false;"><svg><use href="#i-logout"/></svg> Sign Out</a>
      </div>
    </aside>

    <div class="d-overlay" id="overlay" onclick="toggleNav()"></div>

    <!-- MAIN -->
    <div class="d-main">
      <!-- Success -->
      <div id="successBanner" class="d-success" style="display:none">
        <div class="s-dot"><svg><use href="#i-check"/></svg></div>
        <div><h4>You're In!</h4><p>Enrollment confirmed. Start learning below.</p></div>
        <button class="dismiss" onclick="this.parentElement.style.display='none'">&times;</button>
      </div>

      <!-- Header -->
      <div class="d-header">
        <h1 id="greeting">Dashboard</h1>
        <p id="subGreeting">Here's your learning overview</p>
      </div>

      <!-- Stats -->
      <div class="d-stats" id="statsRow">
        <div class="d-stat"><div class="ico c1"><svg><use href="#i-layers"/></svg></div><div><div class="val" id="sCourses">–</div><div class="lbl">Courses</div></div></div>
        <div class="d-stat"><div class="ico c2"><svg><use href="#i-video"/></svg></div><div><div class="val" id="sLessons">–</div><div class="lbl">Lessons</div></div></div>
        <div class="d-stat"><div class="ico c3"><svg><use href="#i-clock"/></svg></div><div><div class="val" id="sHours">–</div><div class="lbl">Hours</div></div></div>
        <div class="d-stat"><div class="ico c4"><svg><use href="#i-trophy"/></svg></div><div><div class="val" id="sComplete">–</div><div class="lbl">Complete</div></div></div>
      </div>

      <!-- Continue -->
      <div id="continueSection" style="display:none"></div>

      <!-- Grid -->
      <div id="coursesSection" class="d-section">
        <div class="d-section-head" id="coursesLabel"><svg><use href="#i-book"/></svg> My Courses</div>
        <div id="courseGrid" class="d-grid">
          <div style="grid-column:1/-1;text-align:center;padding:40px"><div class="qa-spinner" style="width:32px;height:32px;border:2px solid var(--d-border);border-top-color:var(--d-teal);border-radius:50%;animation:qa-spin .8s linear infinite;margin:0 auto"></div></div>
        </div>
      </div>

      <!-- Empty -->
      <div id="emptyState" class="d-empty" style="display:none">
        <div class="icon"><svg><use href="#i-grad"/></svg></div>
        <h3>Your Academy Awaits</h3>
        <p>Browse the catalog and begin your transformation.</p>
        <a href="/academy/" class="qa-btn qa-btn-primary">Explore Courses</a>
      </div>
    </div>
  </div>

  <!-- Mobile toggle -->
  <button class="d-mob-btn" onclick="toggleNav()"><svg><use href="#i-menu"/></svg></button>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/shared.js"></script>
  <script src="/academy/js/academy.js"></script>
  <script>
    /* --- Utils --- */
    function toggleNav() {
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('overlay').classList.toggle('open');
    }
    function handleSignOut() { signOut(); }
    function copyRef() {
      const code = document.getElementById('refCode').textContent;
      navigator.clipboard.writeText(code).then(() => {
        const b = document.querySelector('.d-ref-mini .ref-copy');
        b.textContent = 'Copied!'; setTimeout(() => b.textContent = 'Copy', 2000);
      });
    }
    function toggleQR() {
      document.getElementById('qrWrap').classList.toggle('open');
    }

    /* --- Theme --- */
    function toggleTheme() {
      const html = document.documentElement;
      const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      localStorage.setItem('qa-theme', next);
    }
    // Restore saved theme
    const saved = localStorage.getItem('qa-theme');
    if (saved) document.documentElement.setAttribute('data-theme', saved);

    /* --- Simple QR Code Generator --- */
    function drawQR(canvas, text) {
      // Minimal QR-like visual (real QR would need a library)
      // We'll generate a simple pattern for the referral URL
      const ctx = canvas.getContext('2d');
      const size = canvas.width;
      const cellSize = size / 15;
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, size, size);
      ctx.fillStyle = '#0a1e33';

      // Generate pseudo-random pattern from text
      let hash = 0;
      for (let i = 0; i < text.length; i++) { hash = ((hash << 5) - hash) + text.charCodeAt(i); hash |= 0; }

      // Corner markers
      const drawMarker = (x, y) => {
        ctx.fillRect(x * cellSize, y * cellSize, 7 * cellSize, cellSize);
        ctx.fillRect(x * cellSize, (y+6) * cellSize, 7 * cellSize, cellSize);
        ctx.fillRect(x * cellSize, y * cellSize, cellSize, 7 * cellSize);
        ctx.fillRect((x+6) * cellSize, y * cellSize, cellSize, 7 * cellSize);
        ctx.fillRect((x+2) * cellSize, (y+2) * cellSize, 3 * cellSize, 3 * cellSize);
      };
      drawMarker(0, 0);
      drawMarker(8, 0);
      drawMarker(0, 8);

      // Fill data area
      for (let r = 0; r < 15; r++) {
        for (let c = 0; c < 15; c++) {
          if ((r < 7 && c < 7) || (r < 7 && c > 7) || (r > 7 && c < 7)) continue;
          if (((hash + r * 17 + c * 31) % 3) === 0) {
            ctx.fillRect(c * cellSize, r * cellSize, cellSize, cellSize);
          }
        }
      }
    }

    /* --- Init --- */
    (async () => {
      const user = await getUser();
      if (!user) { window.location.href = '/academy/login.html?redirect=/academy/dashboard.html'; return; }

      // Success
      const params = new URLSearchParams(window.location.search);
      if (params.get('purchase') === 'success') {
        document.getElementById('successBanner').style.display = 'flex';
        window.history.replaceState({}, '', '/academy/dashboard.html');
      }

      // Profile
      const name = user.user_metadata?.full_name || user.email?.split('@')[0] || 'there';
      const firstName = name.split(' ')[0];
      document.getElementById('avatar').textContent = firstName.charAt(0).toUpperCase();
      document.getElementById('profileName').textContent = name;
      document.getElementById('profileEmail').textContent = user.email;

      const hour = new Date().getHours();
      const greet = hour < 12 ? 'Good morning' : hour < 17 ? 'Good afternoon' : 'Good evening';
      document.getElementById('greeting').textContent = `${greet}, ${firstName}`;
      document.getElementById('subGreeting').textContent = "Here's your learning overview";

      // Enrollments
      const enrollments = await getMyEnrollments();
      const grid = document.getElementById('courseGrid');
      const coursesSection = document.getElementById('coursesSection');
      const empty = document.getElementById('emptyState');

      if (!enrollments || enrollments.length === 0) {
        grid.innerHTML = '';
        coursesSection.style.display = 'none';
        document.getElementById('statsRow').style.display = 'none';
        empty.style.display = 'block';
      } else {
        let totalLD = 0, totalMin = 0, totalDone = 0;
        const items = [];

        for (const e of enrollments) {
          const course = e.qa_courses;
          if (!course) continue;
          let ld = 0;
          try {
            const { data } = await sb.from('qa_lesson_progress').select('id,status').eq('enrollment_id', e.id).eq('user_id', user.id);
            if (data) ld = data.filter(p => p.status === 'completed').length;
          } catch(err){}
          const tot = course.total_lessons || 1;
          const pct = Math.round((ld / tot) * 100);
          const done = pct >= 100;
          totalLD += ld;
          totalMin += (course.total_duration_minutes || 0) * (pct / 100);
          if (done) totalDone++;
          items.push({ ...e, course, ld, tot, pct, done });
        }

        document.getElementById('sCourses').textContent = enrollments.length;
        document.getElementById('sLessons').textContent = totalLD;
        document.getElementById('sHours').textContent = totalMin >= 60 ? Math.round(totalMin/60)+'h' : totalMin > 0 ? Math.round(totalMin)+'m' : '0h';
        document.getElementById('sComplete').textContent = totalDone;

        // Continue
        const ip = items.filter(i => !i.done && i.ld > 0).sort((a,b) => new Date(b.last_accessed_at||b.enrolled_at||0) - new Date(a.last_accessed_at||a.enrolled_at||0));
        const showC = ip.length > 0;
        const showS = !showC && items.some(i => i.ld === 0);
        const feat = showC ? ip[0] : showS ? items.find(i => i.ld === 0) : null;

        if (feat) {
          const c = feat.course;
          const lbl = showC ? 'Pick up where you left off' : 'Ready to begin';
          const btn = showC ? 'Resume' : 'Start';
          document.getElementById('continueSection').style.display = '';
          document.getElementById('continueSection').innerHTML = `
            <div class="d-section">
              <div class="d-section-head"><svg><use href="#i-play"/></svg> ${showC ? 'Continue Learning' : 'Start Learning'}</div>
              <a class="d-continue" href="/academy/learn.html?slug=${c.slug}">
                <div class="ct">
                  ${c.thumbnail_url ? `<img src="${c.thumbnail_url}" alt="${c.title}" loading="lazy">` : '<div style="width:100%;height:100%;background:var(--d-navy-mid)"></div>'}
                  <div class="play-o"><span><svg><use href="#i-play"/></svg></span></div>
                </div>
                <div class="cb">
                  <div class="tag"><svg><use href="#i-play"/></svg> ${lbl}</div>
                  <h3>${c.title}</h3>
                  <div class="meta">${feat.ld} of ${feat.tot} lessons${c.total_duration_minutes ? ' · '+formatDuration(c.total_duration_minutes) : ''}</div>
                  ${feat.pct > 0 ? `<div class="prog"><div class="bar"><div class="fill" style="width:${feat.pct}%"></div></div><span class="pct">${feat.pct}%</span></div>` : ''}
                  <div class="go"><svg><use href="#i-arrow"/></svg> ${btn} Course</div>
                </div>
              </a>
            </div>`;
        }

        // Sort
        // Self-H.O.P.E. Workshop Series ordering
        const COURSE_ORDER = {
          'breaking up with your beliefs': 1,
          'power of the question': 2,
          'the power of the question': 2,
          'creative mind mapping': 3,
          'quantum vision boards': 4,
          'becoming present': 5,
          'becoming present: meditation for the busy mind': 5
        };
        function getCourseOrder(title) {
          var t = (title||'').toLowerCase().trim();
          for (var k in COURSE_ORDER) { if (t.includes(k) || t === k) return COURSE_ORDER[k]; }
          return 99;
        }
        items.sort((a,b) => {
          var oa = getCourseOrder(a.course.title), ob = getCourseOrder(b.course.title);
          if (oa !== ob) return oa - ob;
          if(a.done!==b.done) return a.done?1:-1;
          return b.ld-a.ld;
        });
        document.getElementById('coursesLabel').innerHTML = `<svg><use href="#i-book"/></svg> My Courses (${items.length})`;

        grid.innerHTML = items.map(item => {
          const c = item.course;
          let badge = '';
          if (item.done) badge = '<div class="badge done"><svg><use href="#i-check"/></svg> Done</div>';
          else if (item.ld === 0) badge = '<div class="badge new"><svg><use href="#i-star"/></svg> New</div>';
          const act = item.done ? 'Review' : item.ld > 0 ? 'Continue' : 'Start';
          return `
            <a class="d-card" href="/academy/learn.html?slug=${c.slug}">
              <div class="img">
                ${c.thumbnail_url ? `<img src="${c.thumbnail_url}" alt="${c.title}" loading="lazy">` : '<div style="width:100%;height:100%;background:var(--d-navy-mid)"></div>'}
                ${badge}
              </div>
              <div class="bd">
                <h4>${c.title}</h4>
                <div class="mt">
                  <span><svg><use href="#i-video"/></svg> ${item.tot} lessons</span>
                  ${c.total_duration_minutes ? `<span><svg><use href="#i-clock"/></svg> ${formatDuration(c.total_duration_minutes)}</span>` : ''}
                </div>
                ${!item.done ? `
                  <div class="bar-wrap"><div class="bar"><div class="fill" style="width:${item.pct}%"></div></div></div>
                  <div class="bar-label"><span>${item.ld} of ${item.tot}</span><span>${item.pct}%</span></div>
                ` : '<div class="done-text">All lessons completed</div>'}
                <div class="act">${act} <svg><use href="#i-arrow"/></svg></div>
              </div>
            </a>`;
        }).join('');
      }

      // Referral
      try {
        const { data: rd } = await sb.from('referral_codes').select('code,credit_balance,total_earned,successful_referrals').eq('email', user.email.toLowerCase()).single();
        if (rd && rd.code) {
          document.getElementById('refSection').style.display = '';
          document.getElementById('refCode').textContent = rd.code;
          document.getElementById('refBal').textContent = '$'+(rd.credit_balance||0).toFixed(0);
          document.getElementById('refEarn').textContent = '$'+(rd.total_earned||0).toFixed(0);
          // Draw QR
          const url = `https://qp-homepage.netlify.app/academy/?ref=${rd.code}`;
          drawQR(document.getElementById('qrCanvas'), url);
        }
      } catch(e){}

      trackEvent('page_view', null, null, { page: 'dashboard' });
    })();
  </script>
  <script src="/js/events-panel.js"></script>
</body>
</html>
